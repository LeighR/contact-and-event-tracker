<h1>Listing events</h1>

<table class="nice_table tablesorter">
  <thead>
    <tr>
      <th>Event</th>
      <th>Type</th>
      <th>When</th>
      <% if is_admin? %>
      <th colspan="2" style="border: 1px #CCF dashed; text-align:center">Manage</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
  <% @events.each do |event| %>
    <tr>
      <td><%= link_to event.name, event %></td>
      <td><%= event.event_type %></td>
      <td><%= event.start_on %> <%= " - #{event.end_on}" if event.end_on %></td>
      <% if is_admin? %>
      <td><%= link_to 'Edit', edit_event_path(event) %></td>
      <td><%= link_to 'Delete', event, :confirm => "Are you sure you want to permenantly delete the event: #{event.to_s}?", :method => :delete %></td>
      <% end %>
    </tr>
  <% end %>
  </tbody>
</table>

<br />


<% if is_admin? %>
<p>
<%= link_to 'New event', new_event_path %>
</p>
<% end %>

<div id="calendar_now" class="calendars"></div>
<div id="calendar_one_month" class="calendars"></div>
<div id="calendar_two_months" class="calendars"></div>

<div id="event_description" style="display:none"></div>

<script type="text/javascript">
$(document).ready(function()
  {
    $(".nice_table").tablesorter( { widgets: ['zebra'], headers: { 3:{sorter: false}, 4:{sorter: false}, 5:{sorter: false}} });
    
    $('#calendar_now').fullCalendar({ 
      editable: false, events: "/events", height: 300, aspectRatio: 1.2,
      buttonText: { today:null, prev:null, next: null }, eventMouseover: updateEventDescription
    });
    
    $('#calendar_one_month').fullCalendar({ 
      editable: false, events: "/events", height: 300, aspectRatio: 1.2,
      buttonText: { today:null, prev:null, next: null }, eventMouseover: updateEventDescription,
      month: $('#calendar_now').fullCalendar('getDate').getMonth(),
    });
    
    $('#calendar_two_months').fullCalendar({ 
      editable: false, events: "/events", height: 300, aspectRatio: 1.2,
      buttonText: { today:null }, eventMouseover: updateEventDescription,
      month: $('#calendar_one_month').fullCalendar('getDate').getMonth() + 1,
      viewDisplay: function(view) {
        $('#calendar_now').fullCalendar('gotoDate', $('#calendar_two_months').fullCalendar('getDate').getFullYear(), $('#calendar_two_months').fullCalendar('getDate').getMonth() - 2);
        $('#calendar_one_month').fullCalendar('gotoDate', $('#calendar_two_months').fullCalendar('getDate').getFullYear(), $('#calendar_two_months').fullCalendar('getDate').getMonth() - 1);
      }
    });
    
    
    $('#calendar_two_months').ajaxSuccess(function(e, xhr, settings) {
       console.log(settings);
       // $('#calendar_one_month').fullCalendar( 'gotoDate', $('#calendar_two_months').fullCalendar('getDate') );
       // $('#calendar_one_month').fullCalendar('prev');
       // $('#calendar_now').fullCalendar('prev').fullCalendar('prev');
      
    })
  }
);

var updateEventDescription = function(event, jsEvent) {
  $("#event_description")[0].innerHTML = "";  
  $("#event_description").append($("<h3/>", { text : event.title }));
  $("#event_description")[0].innerHTML += "Location: " + event.location + "<br/>";
  $("#event_description")[0].innerHTML += event.description;
  
  $("#event_description").show();
}
</script>